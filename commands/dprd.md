---
description: 生成产品需求文档（PRD），支持产品级和完整版两种模式
argument-hint: [full（可选，输出完整技术方案）]
allowed-tools: Read, Write, Edit, Glob, Bash
---

# /dprd — 产品需求文档

## 模式判定

- 用户输入 `/dprd full` → **完整模式**（输出第 1-9 节）
- 用户输入 `/dprd` → **产品模式**（输出第 1-5 节）

## Step 1：接收产品描述

若用户已在对话中描述产品需求，直接进入 Step 2。否则询问：
- 要解决什么问题？
- 目标用户是谁？
- 核心场景是什么？

## Step 2：澄清需求

逐一提出聚焦问题（每次 1 个维度，给出推荐选项）：
- **核心场景**：用户最常执行的 1-3 个操作是什么？能否举一个完整的使用例子？
- **边界**：明确不做什么？
- **涉及端**：哪些平台/客户端？后端服务？
- **现有系统**：有哪些已有能力可以复用？

完整模式追加：
- **方案倾向**：是否已有备选技术方案？偏好快速验证还是长期迭代？
- **数据约束**：核心实体有哪些？数据量级？

## Step 3：生成 PRD

### 产品模式（第 1-5 节）

#### 1. 概述
- **背景**：为什么要做这个功能
- **目标**：一句话描述预期成果
- **核心价值**：3 个要点（可信度/效率/体验等维度）

#### 2. 核心场景
- 用户交互流程（mermaid sequenceDiagram）
- 渲染示例 / 操作示例（用代码块展示预期效果）

#### 3. 功能规格
- 功能点表格（触发条件、入口、范围、阈值等）
- 每个功能点一个小节

#### 4. 方案对比
- 对比表格（维度 × 方案 A/B/C）
- 推荐策略（明确推荐哪个方案及原因）

> **方案对比置前原则**：先让读者理解"有哪些选择、为什么选这个"，再展开技术细节。

#### 5. UI 与交互规格
- 每个 UI 组件一个小节（位置、样式、交互、显示条件）
- 交互流程图（mermaid flowchart，展示 UI 元素间的关联）
- 单条数据结构字段表（字段、来源、说明）

### 完整模式追加（第 6-9 节）

#### 6. 技术方案
- 每个方案独立小节
- 数据流图（mermaid sequenceDiagram）
- 核心实现要点（后端/客户端分别列出关键文件和改动）
- 格式/协议定义（如有自定义标记、事件、API）

#### 7. 数据模型
- 核心数据结构（代码块，使用项目对应语言）
- 与现有数据模型的关系映射表

#### 8. 边界条件与异常处理
- 按角色/层分组（AI 行为、客户端、后端）
- 表格格式（场景 | 处理方式）

#### 9. 迁移路径（可选）
- 仅当存在多阶段上线计划时输出
- 阶段图（mermaid flowchart）
- 每阶段关键交付物

## Step 4：确定输出路径

询问用户 PRD 输出位置（给出推荐）：
- `.doc/prd/PRD-kebab-case-title.md`（推荐，项目内可追溯）
- 用户指定路径

`.doc/prd/` 不存在时先创建目录。

## Step 5：写入后提示

1. 显示生成的文件路径和模式（产品/完整）
2. 提示：如需将 PRD 拆解为可执行任务，可使用 `/dtask`
3. 产品模式下提示：如需补充技术方案细节，可使用 `/dprd full` 重新生成

## 不做的事

- 不自动写入 task.json（任务拆解由 `/dtask` 负责）
- 不生成代码（PRD 是需求文档，不是实现）

## 写作原则

- 结论先行：每节开头说结论，细节后面展开
- 图表优于文字：流程用 mermaid，规格用表格，示例用代码块
- 具体优于抽象：避免"合理处理"、"适当优化"等模糊表述，写具���的值和行为
