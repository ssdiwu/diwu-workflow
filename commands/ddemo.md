---
description: PRD 通过后，分析功能点的不确定性，输出 Demo 必要性分析报告
argument-hint: [PRD 文件路径（可选）]
allowed-tools: Read, Write, Glob
---

# /ddemo — Demo 必要性分析

## 适用场景

正式版本迭代时，在 `/dprd` 之后、`/dtask` 之前使用。小修小改（加字段、修 bug、改配置）无需执行本命令。

## Step 1：获取输入

优先级：
1. 用户在参数中提供了 PRD 文件路径 → 读取该文件
2. 用户在对话中已描述功能点 → 直接使用
3. 否则询问：PRD 文件路径或功能点列表是什么？

## Step 2：扫描已有能力

用 glob 扫描 `demo/` 目录（如存在），读取每个 Demo 的 README.md 首行，整理已有能力清单。

若 `demo/` 不存在，视为能力库为空，Q1 一律"没做过"。

## Step 3：逐条判断

**判断标准只有一个**：做了之后，结果是可预期的吗？

注意：不是"会不会做"，是"结果可不可预期"。

### 最容易漏判的场景

```
❌ 错误思路："改 Prompt → 会写 Markdown → 不需要 Demo"
✅ 正确思路："改 Prompt → LLM 会不会稳定输出引用标记？→ 不知道 → 需要 Demo"
```

写代码的结果是确定性的（写对就对）。写 Prompt 的结果是概率性的（写对了也可能不按预期工作）。"会做" ≠ "结果可控"。

### 四个判断维度（任意一个"否"→ 需要 Demo）

- **Q1 做过吗？** 团队没做过这件事 → 能力缺口
- **Q2 结果可预期吗？** 对结果把握 < 90% → 不可预期（LLM 行为、第三方 API、性能优化都属于此类）
- **Q3 外部依赖可控吗？** 依赖 LLM / 第三方 API / 用户行为 → 不可控
- **Q4 多模块集成测过吗？** 首次组合多个模块 → 未测过

### 示范

```
| #  | 要做的事                  | 结果可预期？ | 原因                                  | 需要 Demo？ |
|----|--------------------------|------------|--------------------------------------|-----------|
| 1  | 修改 AI 回复的 Prompt 指令 | 不确定      | LLM 是否按格式稳定输出？                | 需要 ✦     |
|    |                          |            | 写对 Prompt ≠ LLM 按预期工作           |           |
| 2  | 新增数据库字段              | 可预期      | 标准 migration，做过很多次              | 不需要     |
| 3  | 新增 REST API 接口         | 可预期      | 已有接口模式，加一个是同类操作            | 不需要     |
| 4  | 流式输出的分段解析           | 不确定      | 跨 chunk 拼接是新能力，没做过            | 需要 ✦     |
| 5  | 前端可交互浮层组件           | 不确定      | 从没做过，不知道框架是否支持该交互模式     | 需要 ✦     |
| 6  | 调整现有列表页样式           | 可预期      | 改 CSS，确定性操作                      | 不需要     |
| 7  | 对接第三方推送服务           | 不确定      | 文档描述和实际行为是否一致？未验证过       | 需要 ✦     |
| 8  | 监听已有消息队列的新事件类型   | 可预期      | 已有监听模式，加一个事件类型              | 不需要     |

结论：8 件事中，4 件直接做，4 件需要 Demo。

| Demo 名称                    | 解决什么问题              | 验证标准                      | 依赖关系          |
|------------------------------|--------------------------|------------------------------|------------------|
| demo-ai-reply-prompt         | AI 回复 Prompt 格式稳定性  | 准确率 > 90%，幻觉率 < 5%     | 无               |
| demo-stream-chunk-parser     | 流式输出跨 chunk 解析      | 拼接结果与预期一致             | 依赖 A 确定输出格式 |
| demo-interactive-overlay     | 前端可交互浮层组件          | 交互回调正常触发               | 无               |
| demo-push-service-integration| 第三方推送服务对接          | 消息送达率 > 99%，延迟 < 500ms | 无               |

执行顺序：demo-ai-reply-prompt → demo-stream-chunk-parser（串行）；demo-interactive-overlay 和 demo-push-service-integration 可并行
```

### 分析模板

```
| #  | 要做的事 | 结果可预期？ | 原因 | 需要 Demo？ |
|----|---------|------------|------|-----------|

结论：N 件事中，X 件直接做，Y 件需要 Demo。

| Demo 名称 | 解决什么问题 | 验证标准 | 依赖关系 |
|-----------|------------|---------|---------|

执行顺序：[独立 Demo 可并行，有依赖的串行]
```

## Step 4：写入文件

路径：`.doc/demo-proposals-{kebab-case-title}.md`

`.doc/` 不存在时先创建。

## Step 5：写入后提示

1. 显示文件路径
2. 若有需要 Demo 的项：提示先完成 Demo 验证，再执行 `/dtask`
3. 若全部直接做：提示可直接执行 `/dtask`

## 不做的事

- 不创建 Demo 目录结构（实施时由 Agent 负责）
- 不写入 task.json（由 `/dtask` 负责）
