{
  "PreToolUse": [
    {
      "matcher": "Bash",
      "hooks": [
        {
          "type": "command",
          "command": "python3 -c \"import json,sys,os; f='.claude/task.json'; d=json.load(open(f)) if os.path.exists(f) else sys.exit(0); t=next((x for x in d['tasks'] if x['status']=='InProgress'),None); t and print('[diwu] Task#'+str(t['id'])+': '+t['description']+chr(10)+chr(10).join('  - '+a for a in t['acceptance']))\" 2>/dev/null||true"
        }
      ]
    }
  ],
  "Stop": [
    {
      "hooks": [
        {
          "type": "command",
          "command": "python3 -c \"import json,sys,os; f='.claude/task.json'; d=json.load(open(f)) if os.path.exists(f) else sys.exit(0); tasks=d.get('tasks',[]); ts=[t for t in tasks if t['status'] in ('InProgress','InSpec')]; ts and print(json.dumps({'decision':'block','reason':'task.json 中还有未完成的任务，请继续执行：\\n'+chr(10).join('#'+str(t['id'])+' '+t['description']+' ['+t['status']+']' for t in ts)}))\" 2>/dev/null||true"
        }
      ]
    }
  ]
}
